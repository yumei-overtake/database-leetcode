with a as (
Select *,
       case when order_date= customer_pref_delivery_date  then 'immediate' else 'scheduled' end as types,
       row_number() over (partition by customer_id order by order_date) as rn
from delivery 
)
select round(sum(case when types='immediate' then 1 else 0 end )*100.0/ count(delivery_id),2) as immediate_percentage 
from a 
where rn=1